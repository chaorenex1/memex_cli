[control]
fail_mode = "closed"
decision_timeout_ms = 300000
abort_grace_ms = 5000
line_tap_channel_capacity = 1024
control_channel_capacity = 128
control_writer_error_capacity = 1
tick_interval_ms = 1000

[policy]
mode = "auto"
default_action = "deny"

denylist = [
  { tool = "shell.exec", action = "exec", reason = "shell is denied by default" },
  { tool = "net.http", action = "net", reason = "network is denied by default" },
]

allowlist = [
  { tool = "fs.read", action = "read", reason = "read is allowed" },
  { tool = "git.*", reason = "git commands allowed" }
]

[memory]
enabled = true
base_url = "https://memory.internal"
api_key = ""
timeout_ms = 10000
search_limit = 6
min_score = 0.2

[prompt_inject]
placement = "system" # system|user
max_items = 3
max_answer_chars = 900
include_meta_line = true

[gatekeeper]
max_inject = 3
min_trust_show = 0.40
min_level_inject = 2
min_level_fallback = 1
block_if_consecutive_fail_ge = 3
skip_if_top1_score_ge = 0.85
digest_head_chars = 80
digest_tail_chars = 80
exclude_stale_by_default = true
active_statuses = ["active", "verified"]

[candidate_extract]
max_candidates = 1
max_answer_chars = 1200
min_answer_chars = 200
context_lines = 8
tool_steps_max = 5
tool_step_args_keys_max = 16
tool_step_value_max_chars = 140
redact = true
strict_secret_block = true
confidence = 0.45

[events_out]
enabled = true
path = "./run.events.jsonl"
channel_capacity = 2048
drop_when_full = true
